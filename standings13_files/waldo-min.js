(function(){Waldo={requests:[],retrieve:function(a){var b={requests:[{uri:a.uri,uriAlias:a.uriAlias,params:a.params,type:a.type||"EXTERNAL",callback:a.callback}]};return this.multi(b)},multi:function(c){var e,d,a,f=c.requests;if(c.callback){this.callback=c.callback}if(f.length>0){for(d=0,a=f.length;d<a;d++){e=f[d];e.index=d;this.requests.push(e)}this.totalRequests=this.requests.length;try{this.response=new WaldoResponse();this._makeRequest()}catch(b){}}else{}return this.response},_makeRequest:function(){var f,c,a,e,d,b=this;while(e=this.requests.shift()){if(!e.uri||typeof(e.uri)==="undefined"){}else{e.resultFormat="json";if(e.type=="EXTERNAL"){d=[];for(f in e.params){if(e.params[f] instanceof Array){for(c=0,a=e.params[f].length;c<a;c++){d.push(f+"="+e.params[f][c])}}else{d.push(f+"="+e.params[f])}}e.uri+=(e.uri.match(/\?/))?"&":"?";e.uri+=d.join("&");e.uri+=e.uriAlias?"&uriAlias="+e.uriAlias:"";e.uri=e.uri+"&responseFormat=jsonp";this._get(e)}else{e.params.resultFormat="json";e.params.responseFormat="json";$.ajax({url:e.uri,type:e.type,data:e.params,dataType:"json",statusCode:{204:function(){var g={statusCode:204,statusMessage:"",uri:this.request.uri,uriAlias:this.request.uriAlias,_content:""};b._handleSuccess(g,this.request)},200:function(g){b._handleSuccess(g,this.request)},201:function(g){b._handleSuccess(g,this.request)},400:function(i){var j=i.responseText,g={statusCode:400,statusMessage:i.responseText,uri:this.request.uri,uriAlias:this.request.uriAlias,_content:""};if(typeof(j)=="string"){try{body=$.parseJSON(j);g=body}catch(h){}}b._handleSuccess(g,this.request)}},request:e})}}}},_handleSuccess:function(d,c){var b,a;a=new WaldoResult(d);c.uriAlias=c.uriAlias||c.index;this.response.addResult(a,c);if(c.callback){if(a.isSuccess()&&c.callback.success){b=c.context||window;c.callback.success.call(a)}else{if(a.isFailure()&&c.callback.failure){b=c.context||window;c.callback.failure.call(a)}}}if(this.response.completedResults==this.totalRequests){if(this.callback&&this.callback.success){this.callback.success.call(this.response)}}},_get:function(f){var c=this,a=false,d=f.index,g="jsonp"+(f.uriAlias||(new Date()).getTime()),e=document.getElementsByTagName("head")[0],b=document.createElement("script");window[g]=function(i){var j=i.objectkey||i;window[g]=undefined;try{delete window[g]}catch(h){}c._handleSuccess(j,f);if(e){e.removeChild(b)}};b.src=f.uri+"&callback="+g;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){a=true;b.onload=b.onreadystatechange=null;if(e&&b.parentNode){e.removeChild(b)}}};e.insertBefore(b,e.firstChild);return undefined}};WaldoResponse=function(a){this.requests=a;this.resultSet={};this.aliases=[];this.iterator=-1;this.completedResults=0};WaldoResponse.prototype={firstResult:function(){return this.resultSet[this.aliases[0]]},nextResult:function(){this.iterator++;if(this.hasNextResult()){return this.resultSet[this.aliases[this.iterator]]}return undefined},resultByAlias:function(a){if(a){return this.resultSet[a]}return},addResult:function(a,c){var b=a.uriAlias||c.uriAlias;this.aliases[c.index]=b;this.resultSet[b]=a;this.completedResults++},hasNextResult:function(){var a=this.iterator;return(a++>=(this.aliases.length))?0:1}};WaldoResult=function(a){this.statusCode=a.statusCode;this.statusMsg=a.statusMessage;this.uri=a.uri;this.uriAlias=a.uriAlias;this._content=a.body};WaldoResult.prototype={isSuccess:function(){return(this.statusCode>=200&&this.statusCode<=299)?1:0},isFailure:function(){return(this.statusCode>=400&&this.statusCode<=499)?1:0},data:function(){return this._content},exception:function(){if(this._content&&this._content.exceptions){return this._content.exceptions}else{if(this.statusMsg!=="undefined"){return this.statusMsg}}return},exceptions:function(){if(this._content&&this._content.exceptions){return this._content.exceptions}return},warnings:function(){if(this._content&&this._content.warnings){return this._content.warnings}return}}})();